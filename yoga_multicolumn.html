<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>20250920 Yoga ‚Äî Â§öÊ¨ÑÈ°ØÁ§∫</title>
  <style>
    :root{--columns:1;--base-font:20px;--min-font:6px}
    html,body{height:100%;margin:0;background:#f7f7f8;font-family:-apple-system,BlinkMacSystemFont,'Noto Sans TC','Microsoft JhengHei',Roboto,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .page{box-sizing:border-box;width:100vw;height:100vh;padding:68px 40px 28px 40px;display:block;overflow:hidden}
    .sheet{height:100%;column-count:var(--columns);column-width:auto;column-gap:20px;column-fill:auto;background:linear-gradient(180deg,rgba(255,255,255,0.95),rgba(250,250,252,0.95));padding:18px;box-shadow:0 6px 20px rgba(0,0,0,0.06);border-radius:10px;overflow:auto;font-size:var(--base-font);line-height:1.45;column-rule:none}

    .sheet * {
      box-sizing: border-box;
    }
    h1{font-size:1.25em;margin:0 0 8px 0;break-inside:avoid}
    h2{font-size:0.98em;margin:6px 0 6px 0}
    ul,ol{margin:4px 0 12px 0;padding-left:1.1em;list-style-position:inside}
    li{margin:4px 0}
    h1,h2,li{break-inside:avoid-column}

    li::marker {
      display: inline-block;
      width: auto;
    }

    ol li, ul li {
      break-inside: avoid;
      page-break-inside: avoid;
    }

    /* Chrome ÁÄèË¶ΩÂô®Â§öÊ¨Ñ‰ΩàÂ±Ä ::marker ‰øÆÂæ© */
    @supports (column-count: 1) {
      ol {
        counter-reset: list-counter;
      }

      ol li {
        list-style: none;
        counter-increment: list-counter;
        position: relative;
        display: flex;
        align-items: flex-start;
      }

      ol li .li-number {
        content: counter(list-counter) ". ";
        font-weight: normal;
        margin-right: 0.5em;
        cursor: pointer;
        color: #007bff;
        text-decoration: underline;
        user-select: none;
        flex-shrink: 0;
        transition: color 0.2s ease;
      }

      ol li .li-number:hover {
        color: #0056b3;
        background-color: rgba(0, 123, 255, 0.1);
        border-radius: 3px;
        padding: 1px 3px;
      }

      ol li .li-content {
        flex: 1;
        cursor: pointer;
        user-select: none;
      }

      /* Hide the original ::before pseudo-element */
      ol li::before {
        display: none;
      }
    }

    @page{size:landscape}

    .toolbar{position:fixed;top:8px;left:8px;right:8px;background:rgba(255,255,255,0.95);border-radius:8px;padding:6px 8px;box-shadow:0 6px 18px rgba(0,0,0,0.08);z-index:100;display:flex;gap:8px;align-items:center;font-size:13px;flex-wrap:wrap}
    .toolbar label{display:flex;gap:6px;align-items:center;white-space:nowrap}
    .toolbar select,.toolbar button,.toolbar input{font-size:13px;padding:6px;border-radius:6px;border:1px solid #e6e6e9;background:#fff;cursor:pointer;min-width:0}
    .toolbar button[aria-pressed="true"]{background:#eaf3ff;border-color:#cfe6ff}

    .toolbar-narrow{display:none;position:fixed;top:8px;left:8px;right:8px;background:rgba(255,255,255,0.95);border-radius:8px;padding:4px 6px;box-shadow:0 6px 18px rgba(0,0,0,0.08);z-index:100;flex-wrap:wrap;gap:4px;align-items:center;justify-content:center;transition:transform 0.3s ease}
    .toolbar-narrow button{font-size:14px;padding:8px;border-radius:6px;border:1px solid #e6e6e9;background:#fff;cursor:pointer;min-width:36px;height:36px;display:flex;align-items:center;justify-content:center}
    .toolbar-narrow button[aria-pressed="true"]{background:#eaf3ff;border-color:#cfe6ff}
    .toolbar-narrow.hidden{transform:translateY(-100%)}
    .toolbar-narrow.minimized{display:flex!important;background:transparent;box-shadow:none;padding:0}
    .toolbar-narrow.minimized button:not(#toggleToolbarBtn):not(#memBtnNarrow):not(#resetMemBtnNarrow){display:none!important}
    .toolbar-narrow.minimized #toggleToolbarBtn{position:fixed;top:8px;right:8px;background:rgba(255,255,255,0.95);box-shadow:0 2px 8px rgba(0,0,0,0.15);z-index:101}
    .toolbar-narrow.minimized #memBtnNarrow{position:fixed;top:8px;right:60px;background:rgba(255,255,255,0.95);box-shadow:0 2px 8px rgba(0,0,0,0.15);z-index:101}
    .toolbar-narrow.minimized #resetMemBtnNarrow{position:fixed;top:8px;right:112px;background:rgba(255,255,255,0.95);box-shadow:0 2px 8px rgba(0,0,0,0.15);z-index:101}

    @media(max-width:768px){
      .toolbar{display:none}
      .toolbar-narrow{display:flex}
      .page{padding:60px 16px 16px 16px;transition:padding 0.3s ease}
      .page.toolbar-hidden{padding:16px 16px 16px 16px}
    }

    @media(max-width:480px){
      .page{padding:60px 8px 8px 8px}
    }

    @media (hover: none) and (pointer: coarse) {
      button {
        min-height: 44px;
        min-width: 44px;
        padding: 8px 12px;
        touch-action: manipulation;
      }

      .sheet {
        user-select: none;
        -webkit-user-select: none;
        -webkit-touch-callout: none;
        touch-action: pan-y pinch-zoom;
      }

      .toolbar-narrow button {
        min-height: 48px;
        min-width: 48px;
        font-size: 16px;
      }

      body {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
      }
    }

    .sheet:active {
      background-color: rgba(0,0,0,0.02);
    }

    /* Memory styles */
    .memorized {
      opacity: 0.6;
      text-decoration: line-through;
      background-color: rgba(0, 200, 0, 0.1);
    }

    .hidden-line {
      display: none !important;
    }

    .completed-last {
      color: red !important;
      font-weight: bold !important;
    }

    /* Music sync highlighting */
    .music-highlight {
      background-color: rgba(255, 193, 7, 0.3) !important;
      transition: background-color 0.5s ease;
    }

    .music-current {
      background-color: rgba(40, 167, 69, 0.4) !important;
      box-shadow: 0 0 8px rgba(40, 167, 69, 0.5);
      transition: all 0.5s ease;
    }

    /* Auto play mode styling */
    .auto-play-current {
      background-color: rgba(0, 123, 255, 0.2) !important;
      border-left: 4px solid #007bff;
      padding-left: 8px;
      box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
      animation: autoPlayPulse 1s ease-in-out;
    }

    .auto-play-completed {
      background-color: rgba(40, 167, 69, 0.15) !important;
      border-left: 2px solid #28a745;
      padding-left: 10px;
      opacity: 0.8;
    }

    @keyframes autoPlayPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    /* Music Player styles */
    .music-player {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      z-index: 200;
      min-width: 350px;
      max-width: 400px;
    }

    .music-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-weight: bold;
      font-size: 14px;
    }

    .music-header button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      font-size: 16px;
    }

    .music-header button:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    .music-content input {
      padding: 6px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
    }

    .music-content button {
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #fff;
      cursor: pointer;
      font-size: 13px;
      margin-left: 8px;
    }

    .music-content button:hover {
      background: #f0f0f0;
    }

    @media(max-width:768px) {
      .music-player {
        bottom: 10px;
        right: 10px;
        left: 10px;
        min-width: auto;
        max-width: none;
      }

      .music-content input {
        width: calc(100% - 80px) !important;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <nav class="toolbar" aria-label="Êñá‰ª∂ÊéßÂà∂">
      <button id="memBtn" aria-pressed="false" title="ÂàáÊèõÈªòËÉåÊ®°ÂºèÔºöÊåâ‰∏ÄÊ¨°Èö±ËóèÂÖ®ÈÉ®ÔºåÂÜçÊåâÁ©∫ÁôΩÊàñ M È°ØÁ§∫‰∏ã‰∏ÄË°å">üìñ ÈªòËÉåÊ®°Âºè (M / Space)</button>
      <button id="colBtn" title="ÂàáÊèõÊ¨ÑÊï∏ (Âø´Êç∑Èçµ 1-6)">üìë 1Ê¨Ñ</button>

      <label>üî§
        <input type="number" id="fontPreset" title="Â≠óÂûãÂ§ßÂ∞è (Âø´Êç∑Èçµ +/-)" value="20" min="6" max="128" step="1" style="width: 60px;">
      </label>

      <button id="fontDecBtn" title="Á∏ÆÂ∞èÂ≠óÂûã (Âø´Êç∑Èçµ -)">-</button>
      <button id="fontIncBtn" title="ÊîæÂ§ßÂ≠óÂûã (Âø´Êç∑Èçµ +)">+</button>

      <button id="autoPlaySlowBtn" title="Ëá™ÂãïÊí≠ÊîæÊ∏õÈÄü">üêå</button>
      <button id="autoPlayBtn" aria-pressed="false" title="Ëá™ÂãïÊí≠ÊîæÈªòËÉåÊ®°Âºè ‚Äî Âø´Êç∑Èçµ A">‚ñ∂Ô∏è Ëá™ÂãïÊí≠Êîæ 120‚ô© (A)</button>
      <button id="autoPlayFastBtn" title="Ëá™ÂãïÊí≠ÊîæÂä†ÈÄü">üê∞</button>
      <button id="resetMemBtn" title="ÈáçÁΩÆÈªòËÉå‰∏¶È°ØÁ§∫ÂÖ®ÈÉ® ‚Äî Âø´Êç∑Èçµ R">üîÑ ÈáçÁΩÆ (R)</button>
      <button id="copyBtn" title="Ë§áË£ΩÂÖ®ÈÉ®ÂÖßÂÆπÂà∞Ââ™Ë≤ºÁ∞ø ‚Äî Âø´Êç∑Èçµ C">üìã Ë§áË£ΩÂÖ®ÈÉ® (C)</button>
      <button id="musicBtn" title="È°ØÁ§∫/Èö±ËóèÈü≥Ê®ÇÊí≠ÊîæÂô®">üéµ Èü≥Ê®Ç</button>
      <button id="musicSyncBtn" title="ÈñãÂïü/ÈóúÈñâÈü≥Ê®ÇÂêåÊ≠•È°ØÁ§∫">üéµ ÂêåÊ≠•</button>
      <button id="helpBtn" title="È°ØÁ§∫‰ΩøÁî®Ë™™Êòé">‚ùì Ë™™Êòé</button>
    </nav>

    <!-- Á™ÑËû¢ÂπïÂ∞àÁî®Â∑•ÂÖ∑Âàó -->
    <nav class="toolbar-narrow" aria-label="Êñá‰ª∂ÊéßÂà∂">
      <button id="memBtnNarrow" aria-pressed="false" title="ÈªòËÉåÊ®°Âºè">üìñ</button>
      <button id="colBtnNarrow" title="ÂàáÊèõÊ¨ÑÊï∏">üìë</button>
      <button id="fontDecBtnNarrow" title="Á∏ÆÂ∞èÂ≠óÂûã">A-</button>
      <button id="fontIncBtnNarrow" title="ÊîæÂ§ßÂ≠óÂûã">A+</button>
      <button id="autoPlaySlowBtnNarrow" title="Ê∏õÈÄü">üêå</button>
      <button id="autoPlayBtnNarrow" aria-pressed="false" title="Ëá™ÂãïÊí≠Êîæ">120‚ô©</button>
      <button id="autoPlayFastBtnNarrow" title="Âä†ÈÄü">üê∞</button>
      <button id="resetMemBtnNarrow" title="ÈáçÁΩÆ">üîÑ</button>
      <button id="copyBtnNarrow" title="Ë§áË£Ω">üìã</button>
      <button id="musicBtnNarrow" title="Èü≥Ê®Ç">üéµ</button>
      <button id="musicSyncBtnNarrow" title="ÂêåÊ≠•">üé∂</button>
      <button id="helpBtnNarrow" title="Ë™™Êòé">‚ùì</button>
      <button id="toggleToolbarBtn" title="ÂàáÊèõÂ∑•ÂÖ∑ÂàóÈ°ØÁ§∫" >‚ò∞</button>
    </nav>

    <div id="sheet" class="sheet">
    </div>

    <!-- YouTube Èü≥Ê®ÇÊí≠ÊîæÂô® -->
    <div id="musicPlayer" class="music-player" style="display: none;">
      <div class="music-header">
        <span>üéµ Áëú‰ºΩÈü≥Ê®Ç</span>
        <button id="closeMusicBtn" title="ÈóúÈñâÈü≥Ê®ÇÊí≠ÊîæÂô®">‚úï</button>
      </div>
      <div class="music-content">
        <select id="musicSelect" style="width: 100%; margin-bottom: 8px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
          <option value="">ÈÅ∏ÊìáÈ†êË®≠Èü≥Ê®Ç...</option>
          <option value="https://www.youtube.com/watch?v=1ZYbU82GVz4">Áëú‰ºΩÈü≥Ê®Ç - ÊîæÈ¨ÜÂÜ•ÊÉ≥ (30ÂàÜÈêò)</option>
          <option value="https://www.youtube.com/watch?v=lFcSrYw-ARY">Áëú‰ºΩÈü≥Ê®Ç - Ê∑±Â∫¶ÊîæÈ¨Ü (1Â∞èÊôÇ)</option>
          <option value="https://www.youtube.com/watch?v=_jCc40op6eM">Áëú‰ºΩÈü≥Ê®Ç - ËàíÁ∑©Èü≥Ê®Ç (45ÂàÜÈêò)</option>
          <option value="https://www.youtube.com/watch?v=uxbQATBAXf8">Áëú‰ºΩÈü≥Ê®Ç - Ëá™ÁÑ∂Èü≥Ê®Ç (20ÂàÜÈêò)</option>
          <option value="custom">Ëá™Ë®ÇÈü≥Ê®ÇÈÄ£Áµê...</option>
        </select>
        <input type="text" id="youtubeUrl" placeholder="Ë≤º‰∏ä YouTube Èü≥Ê®ÇÈÄ£Áµê..." style="width: 100%; margin-bottom: 8px; display: none;">
        <div style="display: flex; gap: 4px;">
          <button id="loadMusicBtn" style="flex: 1;">ËºâÂÖ•Èü≥Ê®Ç</button>
          <button id="openYouTubeBtn" style="flex: 1;">Âú®Êñ∞Ë¶ñÁ™óÈñãÂïü</button>
        </div>
        <div style="display: flex; gap: 4px; margin-top: 4px;">
          <button id="musicSyncBtnPlayer" style="flex: 1; background-color: #007bff; color: white;">üéµ ÂêåÊ≠•</button>
          <select id="syncSpeedSelect" style="flex: 1; padding: 6px;">
            <option value="60">60 BPM</option>
            <option value="80">80 BPM</option>
            <option value="100">100 BPM</option>
            <option value="120" selected>120 BPM</option>
            <option value="140">140 BPM</option>
            <option value="160">160 BPM</option>
          </select>
        </div>
        <div id="youtubePlayer" style="margin-top: 8px;"></div>
        <div id="musicError" style="display: none; color: #e74c3c; font-size: 12px; margin-top: 8px;">
          ÁÑ°Ê≥ïÂµåÂÖ•Ê≠§Èü≥Ê®ÇÊí≠ÊîæÂô®„ÄÇË´ãÈªûÊìä‰∏ãÊñπÈÄ£ÁµêÂú®Êñ∞Ë¶ñÁ™ó‰∏≠Êí≠ÊîæÔºö<br>
          <a id="fallbackMusicLink" href="#" target="_blank" style="color: #007bff; text-decoration: underline; word-break: break-all; font-size: 11px;"></a>
        </div>
        <div id="musicUrlDisplay" style="display: none; margin-top: 8px; font-size: 12px; color: #666;">
          <strong>Áï∂ÂâçÈü≥Ê®ÇÔºö</strong><br>
          <a id="currentMusicLink" href="#" target="_blank" style="color: #007bff; text-decoration: underline; word-break: break-all; font-size: 11px;"></a>
          <div style="margin-top: 4px; font-style: italic; color: #888;">
            üí° ÊèêÁ§∫ÔºöÈªûÈÅ∏Âãï‰ΩúÁ∑®ËôüÂèØÈñãÂïüË©≤ÊôÇÈñìÈªûÁöÑÈü≥Ê®ÇÊí≠Êîæ‰∏¶ÂïüÂãïËá™ÂãïÊí≠ÊîæÊ®°Âºè
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Markdown content for yoga practice
    const yogaContent = `# 20250920 Yoga

## A 00:00 8ÂÄã8Êãç(ÂâçÂ•è)
1. Èü≥Ê®ÇÈñãÂßã5678
2. 22345678
3. Â§ñÊâãÂêàÂçÅ5678
4. ÂÖßÊâãÂêàÂçÅ5678
5. ‰∏≠ÈñìÂêàÊéå5678
6. ËΩâÂêë345678
7. Êâã‰∏ä34ÂæåÂΩé78
8. Êâã‰∏ä34ÂêàÂçÅ78

## B 00:30 16ÂÄã8Êãç(‰∫∫ËÅ≤)
1. Â∫ßÊ§Ö345678
2. Á´ôÂßøÂâçÂΩé5678
3. Âê∏Ê∞£È†≠Êä¨ÂêêÊ∞£ÂâçÂΩé
4. ÂæåË∑≥‰∏ãÁä¨5678
5. Âπ≥Êùø34Ë∂¥‰∏ã78
6. ËõáÂºè34‰∏ãÁä¨78
7. Âè≥ËÖ≥ÂæåÊä¨ÂâçË∑®78
8. ‰∏äËã±ÈõÑ‰∏Ä5678
9. Êâã‰∏ã34‰∏ãÁä¨78
10. Âπ≥Êùø34Ë∂¥‰∏ã78
11. ËõáÂºè34‰∏ãÁä¨78
12. Â∑¶ËÖ≥ÂæåÊä¨ÂâçË∑®78
13. ‰∏äËã±ÈõÑ‰∏Ä5678
14. Êâã‰∏ã34‰∏ãÁä¨78
15. ÂâçË∑≥34ÂâçÂΩé78
16. Â∫ßÊ§Ö345678

## C 01:30 8ÂÄã8Êãç(Èáç‰∫∫ËÅ≤) Á´ôÂßø
1. ÈõôÊâãÂäÉÈñãÂ±±ÂºèÂõûÊ≠£
2. ÈõôÊâãÂêë‰∏ä5678
3. Â∑¶ÂÅ¥ÂΩéÊõ≤5678
4. Â∑¶ÂÅ¥ÂΩéÂõû5678
5. Êâã‰∏ã3456ÊèíËÖ∞
6. Â∑¶ËÜùÂâçÊä¨Â∑¶ËÜùÂ§ñÈñã
7. ÂêàÂçÅ345678
8. Êâã‰∏ä34Êâã‰∏ãËÖ≥‰∏ã

## D 01:59 2ÂÄã8Êãç(ÁÑ°‰∫∫ËÅ≤)ËÆäÊèõÈöäÂΩ¢
1. ËΩâ135Èù¢ÂêëÂâçÈù¢
2. ËΩâ24ÊéíÈù¢ÂêëÂæåÈù¢

## E 02:05 16ÂÄã8Êãç(‰∫∫ËÅ≤)
1. Â∫ßÊ§Ö345678
2. Á´ôÂßøÂâçÂΩé5678
3. Âê∏Ê∞£È†≠Êä¨ÂêêÊ∞£ÂâçÂΩé
4. ÂæåË∑≥‰∏ãÁä¨5678
5. Âπ≥Êùø34Ë∂¥‰∏ã78
6. ËõáÂºè34‰∏ãÁä¨78
7. Âè≥ËÖ≥ÂæåÊä¨ÂâçË∑®78
8. ‰∏äËã±ÈõÑ‰∏Ä5678
9. Êâã‰∏ã34‰∏ãÁä¨78
10. Âπ≥Êùø34Ë∂¥‰∏ã78
11. ËõáÂºè34‰∏ãÁä¨78
12. Â∑¶ËÖ≥ÂæåÊä¨ÂâçË∑®78
13. ‰∏äËã±ÈõÑ‰∏Ä5678
14. Êâã‰∏ã34‰∏ãÁä¨78
15. ÂâçË∑≥34ÂâçÂΩé78
16. Â∫ßÊ§Ö345678

## F 03:05 8ÂÄã8Êãç(Èáç‰∫∫ËÅ≤) Á´ôÂßø
1. ÈõôÊâãÂäÉÈñãÂ±±ÂºèÂõûÊ≠£
2. ÈõôÊâãÂêë‰∏ä5678
3. Âè≥ÂÅ¥ÂΩéÊõ≤5678
4. Âè≥ÂÅ¥ÂΩéÂõû5678
5. Êâã‰∏ã3456ÊèíËÖ∞
6. Âè≥ËÜùÂâçÊä¨Âè≥ËÜùÂ§ñÈñã
7. ÂêàÂçÅ345678
8. Êâã‰∏ä34Êâã‰∏ãËÖ≥‰∏ã

## G 03:35 10ÂÄã8Êãç(ÁØÄÂ•èÁÑ°‰∫∫ËÅ≤)
1. ÈõôÊâãÂêë‰∏ä5678
2. Á´ôÂßøÂâçÂΩé5678
3. Âè≥ËÖ≥Â∑¶ËÖ≥Ê∫ñÂÇôÂ¨∞ÂÖí / ÁÉèÈ¥âÈ†êÂÇô5678
4. Â¨∞ÂÖí1Ê¨°5678      / ÁÉèÈ¥â‰∏äÂéª5678
5. Â¨∞ÂÖí2Ê¨°5678      / ÁÉèÈ¥âÂÅú‰Ωè5678
6. ‰∏ãÁä¨1Ê¨°5678      / ‰∏≠ÈñìÂ¨∞ÂÖí5678
7. ‰∏ãÁä¨2Ê¨°5678      / ‰∏≠ÈñìÂ¨∞ÂÖí5678
8. ‰∏ãÁä¨34Âπ≥Êùø78
9. Ë∂¥‰∏ã345678
10. ËõáÂºè345678

## H 04:11 10ÂÄã8Êãç(ÂæÆÈúáÊíºÁÑ°‰∫∫ËÅ≤)
1. ‰∏ãÁä¨345678
2. ÂÖßË∑®34ËΩâÂ§ñ78     # ÂÖßË∑®ÊåáËøë‰∏≠Èñì
3. Âê∏Ê∞£È†≠Êä¨ÂêêÊ∞£ÂâçÂΩé
4. ÂâçÊâãÊèíËÖ∞ÂâçÊâãÂ±ïÈñã
5. Êâã‰∏ã345678
6. ÂæåÊâãÊèíËÖ∞ÂæåÊâãÂ±ïÈñã
7. Êâã‰∏ã345678
8. ÂæåËΩâ34Êî∂ËÖ≥78
9. Ëπ≤234Êä±Ë∫∫78
10. È†êÂÇôËº™Âºè5678

## I 04:48 10ÂÄã8Êãç(ÂæÆÈúáÊíºÁÑ°‰∫∫ËÅ≤)
1. ‰∏ä2345678  # 135ÊéíÊ©ãÂºè, 24ÊéíËº™Âºè
2. Êíê‰Ωè34‰∏ã678
3. Êä±ËÖ≥345678
4. ÂâçÊªæÁ´ôËµ∑5678
5. Ëµ∞‰Ωç345678
6. Èõô‰∫∫‰∏ãÁä¨5678
7. ÂÄíÁ´ãÊ∫ñÂÇô5678
8. ‰∏ä2345678
9. Êíê‰Ωè345678
10. Âè≥‰∏ãÂ∑¶‰∏ãÂ∞çÈΩäÁ´ôËµ∑  # ÂêåÊôÇÂêàÂçÅ

---
**ÁµêÊùü**`;

    function parseMarkdownToHTML(markdown) {
      let html = '';
      const lines = markdown.split('\n');

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();

        if (line.startsWith('# ')) {
          html += `<h1>${line.substring(2)}</h1>\n`;
        } else if (line.startsWith('## ')) {
          html += `<h2>${line.substring(3)}</h2>\n`;
        } else if (/^\d+\./.test(line)) {
          // Start or continue ordered list
          if (i === 0 || !(/^\d+\./.test(lines[i-1].trim()))) {
            html += '<ol>\n';
          }

          // Extract number and content
          const match = line.match(/^(\d+)\.\s*(.*)$/);
          if (match) {
            const number = match[1];
            const content = match[2];
            html += `<li><span class="li-number" data-number="${number}">${number}. </span><span class="li-content">${content}</span></li>\n`;
          } else {
            html += `<li>${line.replace(/^\d+\.\s*/, '')}</li>\n`;
          }

          // Check if next line is not a list item
          if (i === lines.length - 1 || !(/^\d+\./.test(lines[i+1].trim()))) {
            html += '</ol>\n';
          }
        } else if (line === '---') {
          // Skip horizontal rules in markdown
        } else if (line.startsWith('**') && line.endsWith('**')) {
          html += `<h2 id="endMarker" style="text-align: center; color: #888; margin-top: 30px;">‚Äî ${line.slice(2, -2)} ‚Äî</h2>\n`;
        } else if (line === '') {
          // Skip empty lines
        }
      }

      return html;
    }

    function loadContentFromMarkdown() {
      const contentHTML = parseMarkdownToHTML(yogaContent);
      sheet.innerHTML = contentHTML;
    }

    function initializeAfterContentLoad() {
      // Check if content is loaded by verifying elements exist
      const elements = sheet.querySelectorAll('h1, h2, li');
      if (elements.length === 0) {
        // Content not ready yet, try again
        setTimeout(initializeAfterContentLoad, 50);
        return;
      }

      // Content is ready, proceed with initialization
      applyInitialSettings();
      initMemMode();
      updateAutoPlayButtons();
      setTimeout(checkToolbarWrap, 100);
    }

    const DEFAULT_FONT_SIZE = 20;

    const sheet = document.getElementById('sheet');
    const fontPreset = document.getElementById('fontPreset');
    const memBtn = document.getElementById('memBtn');
    const resetMemBtn = document.getElementById('resetMemBtn');
    const copyBtn = document.getElementById('copyBtn');
    const fontDecBtn = document.getElementById('fontDecBtn');
    const fontIncBtn = document.getElementById('fontIncBtn');
    const autoPlayBtn = document.getElementById('autoPlayBtn');
    const autoPlaySlowBtn = document.getElementById('autoPlaySlowBtn');
    const autoPlayFastBtn = document.getElementById('autoPlayFastBtn');

    const colBtn = document.getElementById('colBtn');

    const colBtnNarrow = document.getElementById('colBtnNarrow');
    const fontDecBtnNarrow = document.getElementById('fontDecBtnNarrow');
    const fontIncBtnNarrow = document.getElementById('fontIncBtnNarrow');
    const memBtnNarrow = document.getElementById('memBtnNarrow');
    const autoPlayBtnNarrow = document.getElementById('autoPlayBtnNarrow');
    const autoPlaySlowBtnNarrow = document.getElementById('autoPlaySlowBtnNarrow');
    const autoPlayFastBtnNarrow = document.getElementById('autoPlayFastBtnNarrow');
    const resetMemBtnNarrow = document.getElementById('resetMemBtnNarrow');
    const copyBtnNarrow = document.getElementById('copyBtnNarrow');
    const toggleToolbarBtn = document.getElementById('toggleToolbarBtn');
    const helpBtn = document.getElementById('helpBtn');
    const helpBtnNarrow = document.getElementById('helpBtnNarrow');
    const musicBtn = document.getElementById('musicBtn');
    const musicBtnNarrow = document.getElementById('musicBtnNarrow');
    const musicPlayer = document.getElementById('musicPlayer');
    const closeMusicBtn = document.getElementById('closeMusicBtn');
    const youtubeUrl = document.getElementById('youtubeUrl');
    const loadMusicBtn = document.getElementById('loadMusicBtn');
    const openYouTubeBtn = document.getElementById('openYouTubeBtn');
    const musicError = document.getElementById('musicError');
    const musicSelect = document.getElementById('musicSelect');
    const musicSyncBtn = document.getElementById('musicSyncBtn');
    const musicSyncBtnNarrow = document.getElementById('musicSyncBtnNarrow');
    const musicSyncBtnPlayer = document.getElementById('musicSyncBtnPlayer');
    const syncSpeedSelect = document.getElementById('syncSpeedSelect');
    const musicUrlDisplay = document.getElementById('musicUrlDisplay');
    const currentMusicLink = document.getElementById('currentMusicLink');
    const fallbackMusicLink = document.getElementById('fallbackMusicLink');

    let allLines = [];
    let memActive = false;
    let memIndex = 0;
    let autoPlayActive = false;
    let autoPlayTimer = null;
    let currentColumns = 1;
    let toolbarVisible = true;
    let autoPlaySpeed = 120; // BPM (beats per minute)
    let youtubePlayer = null;
    let musicPlayerVisible = false;
    let musicSyncActive = false;
    let musicSyncIndex = 0;
    let musicSyncTimer = null;
    let musicSyncSpeed = 120; // BPM for music sync

    // Default yoga music
    const defaultMusicUrl = 'https://www.youtube.com/watch?v=pICAha0nsb0';

    function getAutoPlayInterval() {
      // ÊØèË°å8ÊãçÔºåÊâÄ‰ª•ÈñìÈöî = (60000ms / BPM) * 8
      return (60000 / autoPlaySpeed) * 8;
    }

    function setColumnCount(count) {
      currentColumns = count;
      sheet.style.columnCount = count;
      sheet.style.columnWidth = 'auto';
      sheet.style.columnRule = 'none';
      sheet.setAttribute('data-columns', count);

      const display = sheet.style.display;
      sheet.style.display = 'none';
      // eslint-disable-next-line no-unused-expressions
      sheet.offsetHeight;
      sheet.style.display = display;      updateColumnButtons();
    }

    function applyInitialSettings(){
      sheet.style.fontSize = fontPreset.value + 'px';

      const maxColumns = calculateMaxColumns();
      setColumnCount(maxColumns);
    }

    function updateColumnButtons(){
      colBtn.textContent = `üìë ${currentColumns}Ê¨Ñ`;
      colBtnNarrow.textContent = `üìë${currentColumns}`;
    }

    function updateAutoPlayButtons(){
      const speedText = `${autoPlaySpeed}‚ô©`;
      autoPlayBtn.innerHTML = `‚ñ∂Ô∏è Ëá™ÂãïÊí≠Êîæ ${speedText} (A)`;
      autoPlayBtnNarrow.innerHTML = `${speedText}`;
    }

    function changeAutoPlaySpeed(delta) {
      autoPlaySpeed = Math.max(60, Math.min(200, autoPlaySpeed + delta));
      updateAutoPlayButtons();

      // If auto play is active, restart with new speed
      if (autoPlayActive) {
        clearInterval(autoPlayTimer);
        autoPlayTimer = setInterval(() => {
          if (memActive && memIndex < allLines.length) {
            revealNextLine();
          } else {
            autoPlayActive = false;
            autoPlayBtn.setAttribute('aria-pressed', 'false');
            autoPlayBtnNarrow.setAttribute('aria-pressed', 'false');
            if (autoPlayTimer) {
              clearInterval(autoPlayTimer);
              autoPlayTimer = null;
            }
          }
        }, getAutoPlayInterval());
      }
    }

    let touchStartX = 0;
    let touchStartY = 0;
    let touchStartTime = 0;
    let lastTouchEnd = 0;

    sheet.addEventListener('touchstart', (e) => {
      if (e.touches.length === 1) {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        touchStartTime = Date.now();
      }
    }, { passive: true });

    function handleDoubleTap(touchEndTime) {
      const isDoubleTap = touchEndTime - lastTouchEnd <= 300;
      lastTouchEnd = touchEndTime;
      return isDoubleTap;
    }

    function handleTap(deltaX, deltaY, deltaTime, e) {
      if (Math.abs(deltaX) < 10 && Math.abs(deltaY) < 10 && deltaTime < 200) {
        // Check if the tap is on a clickable element on mobile
        const target = e.target;

        // Handle taps on li numbers (music play)
        if (target.classList.contains('li-number')) {
          e.preventDefault();
          target.click();
          return true;
        }

        // Handle taps on li content (memory mode)
        if (target.classList.contains('li-content')) {
          e.preventDefault();
          target.click();
          return true;
        }

        // Handle taps on li elements or h2 elements
        const isClickableElement = target.tagName === 'LI' || target.tagName === 'H2' || target.closest('li') || target.closest('h2');

        // On mobile devices with touch input, allow li and h2 clicks to pass through
        if (window.innerWidth <= 768 && isClickableElement) {
          // Trigger the click event manually to ensure consistent behavior
          e.preventDefault(); // Prevent duplicate events
          if (target.tagName === 'LI' || target.closest('li')) {
            const li = target.tagName === 'LI' ? target : target.closest('li');
            li.click();
          } else if (target.tagName === 'H2' || target.closest('h2')) {
            const h2 = target.tagName === 'H2' ? target : target.closest('h2');
            h2.click();
          }
          return true;
        }

        // For other cases, handle as memory mode toggle
        e.preventDefault();
        if (!memActive) {
          toggleMemMode();
        } else {
          revealNextLine();
        }
        return true;
      }
      return false;
    }

    function handleHorizontalSwipe(deltaX, e) {
      e.preventDefault();
      if (deltaX > 0) {
        toggleColumns();
      } else {
        const maxColumns = calculateMaxColumns();
        const nextColumns = currentColumns <= 1 ? maxColumns : currentColumns - 1;
        setColumnCount(nextColumns);
      }
    }

    function handleVerticalSwipe(deltaY, e) {
      e.preventDefault();
      if (deltaY < 0) {
        changeFont(2);
      } else {
        changeFont(-2);
      }
    }

    function handleSwipeGestures(deltaX, deltaY, deltaTime, e) {
      const minSwipeDistance = 50;
      const maxSwipeTime = 500;

      if (deltaTime >= maxSwipeTime) {
        return;
      }

      if (Math.abs(deltaX) > minSwipeDistance && Math.abs(deltaX) > Math.abs(deltaY)) {
        handleHorizontalSwipe(deltaX, e);
      }
      else if (Math.abs(deltaY) > minSwipeDistance && Math.abs(deltaY) > Math.abs(deltaX)) {
        handleVerticalSwipe(deltaY, e);
      }
    }

    sheet.addEventListener('touchend', (e) => {
      if (e.changedTouches.length !== 1) {
        return;
      }

      const touchEndX = e.changedTouches[0].clientX;
      const touchEndY = e.changedTouches[0].clientY;
      const touchEndTime = Date.now();

      const deltaX = touchEndX - touchStartX;
      const deltaY = touchEndY - touchStartY;
      const deltaTime = touchEndTime - touchStartTime;

      if (handleDoubleTap(touchEndTime)) {
        e.preventDefault();
        return;
      }

      if (handleTap(deltaX, deltaY, deltaTime, e)) {
        return;
      }

      handleSwipeGestures(deltaX, deltaY, deltaTime, e);
    }, { passive: false });

    function toggleColumns(){
      const maxColumns = calculateMaxColumns();
      const nextColumns = currentColumns >= maxColumns ? 1 : currentColumns + 1;
      setColumnCount(nextColumns);
    }

    function toggleToolbar(){
      const toolbarNarrow = document.querySelector('.toolbar-narrow');
      const page = document.querySelector('.page');

      if(toolbarVisible){
        // Hide all buttons except toggle button
        toolbarNarrow.classList.add('minimized');
        page.classList.add('toolbar-hidden');
        toggleToolbarBtn.textContent = '‚ò∞';
        toolbarVisible = false;
      } else {
        // Show all buttons
        toolbarNarrow.classList.remove('minimized');
        page.classList.remove('toolbar-hidden');
        toggleToolbarBtn.textContent = '‚ò∞';
        toolbarVisible = true;
      }
    }

    function calculateMaxColumns(){
      const viewportWidth = window.innerWidth - 80;
      const fontSize = parseInt(window.getComputedStyle(sheet).fontSize) || DEFAULT_FONT_SIZE;

      const testDiv = document.createElement('div');
      testDiv.style.cssText = `
        position: absolute;
        top: -9999px;
        font-family: ${window.getComputedStyle(sheet).fontFamily};
        font-size: ${fontSize}px;
        line-height: 1.45;
        white-space: nowrap;
        visibility: hidden;
      `;
      document.body.appendChild(testDiv);

      let maxLineWidth = 0;
      const lines = sheet.querySelectorAll('h1, h2, li');
      lines.forEach(line => {
        testDiv.textContent = line.textContent;
        maxLineWidth = Math.max(maxLineWidth, testDiv.offsetWidth);
      });

      document.body.removeChild(testDiv);

      const minColumnWidth = maxLineWidth + 40;
      const maxPossibleColumns = Math.floor(viewportWidth / minColumnWidth);
      return Math.max(1, Math.min(maxPossibleColumns, 6));
    }

    function responsiveColumnAdjust(){
      const maxColumns = calculateMaxColumns();
      setColumnCount(maxColumns);
    }

    function checkToolbarWrap(){
      if (window.innerWidth <= 768) {
        return;
      }

      const toolbar = document.querySelector('.toolbar');
      const toolbarNarrow = document.querySelector('.toolbar-narrow');
      const page = document.querySelector('.page');

      toolbar.style.display = 'flex';
      toolbarNarrow.style.display = 'none';

      setTimeout(() => {
        const buttons = toolbar.querySelectorAll('button, label');
        if (buttons.length < 2) return;

        const firstButton = buttons[0];
        const lastButton = buttons[buttons.length - 1];

        const firstRect = firstButton.getBoundingClientRect();
        const lastRect = lastButton.getBoundingClientRect();

        const isWrapped = Math.abs(firstRect.top - lastRect.top) > 10;

        if (isWrapped) {
          toolbar.style.display = 'none';
          toolbarNarrow.style.display = 'flex';
        } else {
          // Adjust page padding based on toolbar height
          const toolbarHeight = toolbar.offsetHeight;
          const newPaddingTop = toolbarHeight + 28; // 28px is base margin
          page.style.paddingTop = `${newPaddingTop}px`;
        }
      }, 10);
    }

    colBtn.addEventListener('click', toggleColumns);
    colBtnNarrow.addEventListener('click', toggleColumns);

    fontPreset.addEventListener('input', ()=>{
      const minFont = parseInt(fontPreset.min) || 6;
      const maxFont = parseInt(fontPreset.max) || 128;
      const fontSize = Math.max(minFont, Math.min(maxFont, parseInt(fontPreset.value) || DEFAULT_FONT_SIZE));
      fontPreset.value = fontSize;
      sheet.style.fontSize = fontSize + 'px';
      responsiveColumnAdjust();
      setTimeout(checkToolbarWrap, 100);
    });

    function changeFont(delta){
      const cur = parseInt(window.getComputedStyle(sheet).fontSize) || DEFAULT_FONT_SIZE;
      const minFont = parseInt(fontPreset.min) || 6;
      const maxFont = parseInt(fontPreset.max) || 128;
      const next = Math.max(minFont, Math.min(maxFont, cur + delta));
      sheet.style.fontSize = next + 'px';
      document.getElementById('fontPreset').value = next;
      responsiveColumnAdjust();
      setTimeout(checkToolbarWrap, 100);
    }

    function setColumns(n){
      const maxColumns = calculateMaxColumns();
      const num = Math.min(maxColumns, Math.max(1, Number(n)));
      setColumnCount(num);
    }

    function initMemMode(){
      const listItems = sheet.querySelectorAll('li');
      const h2Items = sheet.querySelectorAll('h2');

      // Make li elements clickable without checkboxes
      listItems.forEach((li, index) => {
        li.dataset.index = index;

        // Handle clicks on li number (open music)
        const liNumber = li.querySelector('.li-number');
        if (liNumber) {
          liNumber.addEventListener('click', (event) => {
            event.preventDefault();
            event.stopPropagation();
            openTimestampedUrl(index);
          });
        }

        // Handle clicks on li content (memory mode)
        const liContent = li.querySelector('.li-content');
        if (liContent) {
          liContent.addEventListener('click', (event) => {
            event.preventDefault();
            event.stopPropagation();
            handleLiClick(event, li);
          });
        }

        // Fallback: if clicked on li but not on specific parts
        li.addEventListener('click', (event) => {
          // Only trigger if the click wasn't handled by number or content
          if (!event.target.closest('.li-number') && !event.target.closest('.li-content')) {
            handleLiClick(event, li);
          }
        });
      });

      // Make h2 elements clickable for group control
      h2Items.forEach((h2, index) => {
        h2.style.cursor = 'pointer';
        h2.style.userSelect = 'none';
        h2.dataset.h2Index = index;
        h2.addEventListener('click', handleH2Click);
      });

      allLines = Array.from(sheet.querySelectorAll('li'));
      memActive = false;
      memIndex = 0;
      allLines.forEach(el => el.classList.remove('hidden-line', 'memorized'));
      memBtn.setAttribute('aria-pressed','false');
    }

    function handleLiClick(event, targetLi = null) {
      event.preventDefault();
      event.stopPropagation();

      const li = targetLi || event.currentTarget;

      // Toggle memorized state
      if (li.classList.contains('memorized')) {
        li.classList.remove('memorized');
      } else {
        li.classList.add('memorized');
      }

      // Clear completed state when manually changing memory state
      li.classList.remove('completed-last');

      // Update memory mode display if active
      if (memActive) {
        updateMemoryDisplay();
      }
    }

    function handleH2Click(event) {
      event.preventDefault();
      event.stopPropagation();

      const h2 = event.currentTarget;

      // Find all li elements that belong to this h2 section
      let currentElement = h2.nextElementSibling;
      const sectionLiElements = [];

      while (currentElement && currentElement.tagName !== 'H2') {
        if (currentElement.tagName === 'OL' || currentElement.tagName === 'UL') {
          // If it's a list, get all li elements inside it
          const lis = currentElement.querySelectorAll('li');
          sectionLiElements.push(...lis);
        } else if (currentElement.tagName === 'LI') {
          sectionLiElements.push(currentElement);
        }
        currentElement = currentElement.nextElementSibling;
      }

      // Check current state of all li elements in this section
      const memorizedCount = sectionLiElements.filter(li => li.classList.contains('memorized')).length;
      const totalCount = sectionLiElements.length;

      let shouldMemorize;
      if (memorizedCount === 0) {
        // All unmemorized -> memorize all
        shouldMemorize = true;
      } else if (memorizedCount === totalCount) {
        // All memorized -> unmemorize all
        shouldMemorize = false;
      } else {
        // Partially memorized -> unmemorize all
        shouldMemorize = false;
      }

      // Apply the new state to all li elements in this section
      sectionLiElements.forEach(li => {
        if (shouldMemorize) {
          li.classList.add('memorized');
        } else {
          li.classList.remove('memorized');
        }
        // Clear completed state when manually changing memory state
        li.classList.remove('completed-last');
      });

      // Update memory mode display if active
      if (memActive) {
        updateMemoryDisplay();
      }
    }

    function updateMemoryDisplay() {
      allLines.forEach((li, index) => {
        if (li.classList.contains('memorized')) {
          // Keep memorized items visible
          li.classList.remove('hidden-line');
        } else if (memActive) {
          // In memory mode, only hide lines that haven't been revealed yet
          if (index >= memIndex) {
            li.classList.add('hidden-line');
          }
          // Don't hide lines that have already been revealed (index < memIndex)
        }
      });
    }

    function hideUnmemorizedLines(){
      allLines.forEach(li => {
        if (!li.classList.contains('memorized')) {
          li.classList.add('hidden-line');
        }
      });
    }

    function revealNextLine(){
      // Find next unmemorized line
      while(memIndex < allLines.length) {
        const li = allLines[memIndex];

        if (!li.classList.contains('memorized')) {
          // This is an unmemorized line, reveal it
          li.classList.remove('hidden-line');

          // Ëá™ÂãïÊªæÂãïÂà∞ÊúÄÂæåÈ°ØÁ§∫ÁöÑË°å
          li.scrollIntoView({
            behavior: 'smooth',
            block: 'end'
          });

          memIndex++;
          return;
        }

        // Skip memorized lines
        memIndex++;
      }

      // No more unmemorized lines - mark the end marker as completed
      const endMarker = document.getElementById('endMarker');
      if (endMarker) {
        endMarker.classList.add('completed-last');
      }

      memActive = false;
      memBtn.setAttribute('aria-pressed','false');
      memBtnNarrow.setAttribute('aria-pressed','false');
      memIndex = 0;
    }

    function toggleMemMode(){
      if(!memActive){
        hideUnmemorizedLines();
        memActive = true;
        memIndex = 0;
        memBtn.setAttribute('aria-pressed','true');
        memBtnNarrow.setAttribute('aria-pressed','true');
      } else {
        revealNextLine();
      }
    }

    function resetMem(){
      allLines.forEach(el => {
        el.classList.remove('hidden-line', 'memorized', 'completed-last', 'auto-play-current', 'auto-play-completed', 'music-highlight', 'music-current');
      });

      // Also clear the end marker
      const endMarker = document.getElementById('endMarker');
      if (endMarker) {
        endMarker.classList.remove('completed-last');
      }

      memActive = false;
      memIndex = 0;
      autoPlayActive = false;
      if(autoPlayTimer) {
        clearInterval(autoPlayTimer);
        autoPlayTimer = null;
      }

      // Stop music sync as well
      stopMusicSync();

      memBtn.setAttribute('aria-pressed','false');
      autoPlayBtn.setAttribute('aria-pressed','false');
      memBtnNarrow.setAttribute('aria-pressed','false');
      autoPlayBtnNarrow.setAttribute('aria-pressed','false');

      resetFontSize();
    }

    function resetFontSize() {
      fontPreset.value = DEFAULT_FONT_SIZE;
      sheet.style.fontSize = DEFAULT_FONT_SIZE + 'px';

      const maxColumns = calculateMaxColumns();
      setColumnCount(maxColumns);
    }

    function showHelp() {
      const helpContent = `
üìñ Áëú‰ºΩÁ∑¥ÁøíÈ†ÅÈù¢‰ΩøÁî®Ë™™Êòé

‚ö° Âø´ÈÄüÊìç‰Ωú
üíª ÈõªËÖ¶ÔºöSpaceÈçµ=Ë®òÊÜ∂Ê®°Âºè | RÈçµ=ÈáçÁΩÆ | MÈçµ=Ë®òÊÜ∂ÂàáÊèõ
üì± Ëß∏ÊéßÔºöÂñÆÊìä=Ë®òÊÜ∂Ê®°Âºè | Â∑¶Âè≥Êªë=Ë™øÊ¨ÑÊï∏ | ‰∏ä‰∏ãÊªë=Ë™øÂ≠óÂûã

üéµ Èü≥Ê®ÇÂêåÊ≠•ÂäüËÉΩ
‚Ä¢ ÈªûÈÅ∏Âãï‰ΩúÁ∑®ËôüÔºöÈñãÂïüË©≤Âãï‰ΩúÊôÇÈñìÈªûÁöÑÈü≥Ê®ÇÊí≠Êîæ‰∏¶ÂïüÂãïËá™ÂãïÊí≠ÊîæÊ®°Âºè
‚Ä¢ ÈªûÈÅ∏Âãï‰ΩúÂÖßÂÆπÔºöÂàáÊèõË®òÊÜ∂Ê®°ÂºèÁãÄÊÖã
‚Ä¢ Ëá™ÂãïÊí≠ÊîæÊ®°ÂºèÔºöÂæûÊåáÂÆöÂãï‰ΩúÈñãÂßãÔºåÊåâÁØÄÊãçËá™ÂãïÈ´ò‰∫ÆÈ°ØÁ§∫ÂæåÁ∫åÂãï‰Ωú
‚Ä¢ ÂêåÊ≠•Êí≠ÊîæÔºöÈñãÂïüÂêåÊ≠•Ê®°ÂºèÔºåÈü≥Ê®ÇÊí≠ÊîæÊôÇÊúÉÈ´ò‰∫ÆÈ°ØÁ§∫Â∞çÊáâÂãï‰Ωú
‚Ä¢ BPMË™øÊï¥ÔºöÂèØË™øÊï¥ 60-160 BPM ÁöÑÂêåÊ≠•ÈÄüÂ∫¶
‚Ä¢ ÂµåÂÖ•Â§±ÊïóÔºöÁï∂ÁÑ°Ê≥ïÂµåÂÖ•YouTubeÊí≠ÊîæÂô®ÊôÇÔºåÊúÉÈ°ØÁ§∫ÂèØÈªûÊìäÁöÑÈÄ£Áµê

 MemoryÊ®°ÂºèÈ°ØÁ§∫ÈÇèËºØ
‚Ä¢ È†ÜÂ∫èÈ°ØÁ§∫ÔºöÂ§öÊ¨ÑÊ®°Âºè‰∏ãÂÖàÈ°ØÁ§∫ÂÆåÁ¨¨‰∏ÄÊ¨ÑÔºåÂÜçÈ°ØÁ§∫Á¨¨‰∫åÊ¨Ñ
‚Ä¢ Ë°åÁ¥öÊéßÂà∂ÔºöÊØèÊ¨°ÊåâÁ©∫ÁôΩÈçµÊàñMÈçµÈ°ØÁ§∫‰∏ã‰∏ÄË°åÂÖßÂÆπ
‚Ä¢ Ëá™ÂãïÊí≠ÊîæÔºöÂèØË®≠ÂÆöÊØè4ÁßíËá™ÂãïÈ°ØÁ§∫‰∏ã‰∏ÄË°å

üì± Ëß∏ÊéßÊâãÂã¢Êìç‰Ωú
üëÜ ÂñÆÊìäÂãï‰ΩúÁ∑®ËôüÔºöÈñãÂïüË©≤ÊôÇÈñìÈªûÁöÑÈü≥Ê®ÇÊí≠Êîæ‰∏¶ÂïüÂãïËá™ÂãïÊí≠ÊîæÊ®°Âºè
üëÜ ÂñÆÊìäÂãï‰ΩúÂÖßÂÆπÔºöÂàáÊèõË®òÊÜ∂Ê®°ÂºèÁãÄÊÖã
üëàüëâ Â∑¶Âè≥ÊªëÂãïÔºöË™øÊï¥Ê¨ÑÊï∏ (‚ÜíÂè≥ÊªëÂ¢ûÂä†Ôºå‚ÜêÂ∑¶ÊªëÊ∏õÂ∞ë)
üëÜüëá ‰∏ä‰∏ãÊªëÂãïÔºöË™øÊï¥Â≠óÂûã (‚Üë‰∏äÊªëÊîæÂ§ßÔºå‚Üì‰∏ãÊªëÁ∏ÆÂ∞è)

‚å®Ô∏è ÈçµÁõ§Âø´Êç∑Èçµ
SpaceÔºöË®òÊÜ∂Ê®°ÂºèÂàáÊèõ/È°ØÁ§∫‰∏ã‰∏ÄË°å
RÔºöÈáçÁΩÆ | MÔºöË®òÊÜ∂Ê®°ÂºèÂàáÊèõ | AÔºöËá™ÂãïÊí≠ÊîæÂàáÊèõ
CÔºöË§áË£ΩÂÖ®ÈÉ®ÂÖßÂÆπ | +/-ÔºöÊîæÂ§ß/Á∏ÆÂ∞èÂ≠óÂûã | 1-6ÔºöÁõ¥Êé•Ë®≠ÂÆöÊ¨ÑÊï∏
      `;

      alert(helpContent);
    }

    function toggleMusicPlayer() {
      if (musicPlayerVisible) {
        musicPlayer.style.display = 'none';
        musicPlayerVisible = false;
      } else {
        musicPlayer.style.display = 'block';
        musicPlayerVisible = true;
      }
    }

    function extractVideoId(url) {
      const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
      const match = url.match(regExp);
      return (match && match[2].length === 11) ? match[2] : null;
    }

    function loadYouTubeAPI() {
      if (window.YT) {
        return Promise.resolve();
      }

      return new Promise((resolve) => {
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        window.onYouTubeIframeAPIReady = resolve;
      });
    }

    function createYouTubePlayer(videoId) {
      const currentUrl = youtubeUrl.value.trim() || defaultMusicUrl;
      const musicUrlDisplay = document.getElementById('musicUrlDisplay');
      const currentMusicLink = document.getElementById('currentMusicLink');
      const musicError = document.getElementById('musicError');
      const fallbackMusicLink = document.getElementById('fallbackMusicLink');

      // Always show current music URL
      currentMusicLink.href = currentUrl;
      currentMusicLink.textContent = currentUrl;
      musicUrlDisplay.style.display = 'block';

      // Hide error initially
      musicError.style.display = 'none';

      loadYouTubeAPI().then(() => {
        if (youtubePlayer) {
          youtubePlayer.destroy();
        }

        youtubePlayer = new YT.Player('youtubePlayer', {
          height: '200',
          width: '100%',
          videoId: videoId,
          playerVars: {
            autoplay: 0,
            controls: 1,
            rel: 0,
            showinfo: 0,
            modestbranding: 1,
            origin: window.location.origin
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange,
            'onError': function(event) {
              console.warn('YouTube Player Error:', event.data);
              showEmbedError(currentUrl);
            }
          }
        });

        // Set a timeout to detect if player fails to load
        setTimeout(() => {
          if (!youtubePlayer || !youtubePlayer.getPlayerState) {
            showEmbedError(currentUrl);
          }
        }, 5000);

      }).catch(error => {
        console.error('YouTube API Error:', error);
        showEmbedError(currentUrl);
      });
    }

    function showEmbedError(currentUrl) {
      const musicError = document.getElementById('musicError');
      const fallbackMusicLink = document.getElementById('fallbackMusicLink');

      fallbackMusicLink.href = currentUrl;
      fallbackMusicLink.textContent = currentUrl;
      musicError.style.display = 'block';
    }

    function onPlayerReady(event) {
      console.log('YouTube player ready');
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        if (musicSyncActive) {
          startMusicSync();
        }
      } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
        if (musicSyncActive) {
          stopMusicSync();
        }
      }
    }

    function startMusicSync() {
      stopMusicSync(); // Clear any existing timer
      musicSyncIndex = 0;

      // Clear previous highlights
      document.querySelectorAll('.music-highlight, .music-current').forEach(el => {
        el.classList.remove('music-highlight', 'music-current');
      });

      // Calculate timing based on BPM (8 beats per line)
      const beatsPerLine = 8;
      const millisecondsPerBeat = 60000 / musicSyncSpeed;
      const millisecondsPerLine = millisecondsPerBeat * beatsPerLine;

      musicSyncTimer = setInterval(() => {
        const allItems = document.querySelectorAll('#sheet li, #sheet h2');

        if (musicSyncIndex < allItems.length) {
          // Remove previous current highlight
          document.querySelectorAll('.music-current').forEach(el => {
            el.classList.remove('music-current');
            el.classList.add('music-highlight');
          });

          const currentItem = allItems[musicSyncIndex];

          if (memActive) {
            // In memory mode, reveal the line
            currentItem.classList.add('memorized');
          }

          // Add current highlight
          currentItem.classList.add('music-current');

          musicSyncIndex++;
        } else {
          // Reached the end
          stopMusicSync();
        }
      }, millisecondsPerLine);
    }

    function stopMusicSync() {
      if (musicSyncTimer) {
        clearInterval(musicSyncTimer);
        musicSyncTimer = null;
      }
    }

    function toggleMusicSync() {
      musicSyncActive = !musicSyncActive;
      const syncBtn = document.getElementById('musicSyncBtn');
      const syncBtnNarrow = document.getElementById('musicSyncBtnNarrow');
      const syncBtnPlayer = document.getElementById('musicSyncBtnPlayer');

      if (musicSyncActive) {
        syncBtn.textContent = 'üéµ ÂêåÊ≠•‰∏≠';
        syncBtn.style.backgroundColor = '#28a745';
        syncBtnNarrow.textContent = 'üé∂';
        syncBtnNarrow.style.backgroundColor = '#28a745';
        syncBtnPlayer.textContent = 'üéµ ÂêåÊ≠•‰∏≠';
        syncBtnPlayer.style.backgroundColor = '#28a745';

        // If music is playing, start sync immediately
        if (youtubePlayer && youtubePlayer.getPlayerState && youtubePlayer.getPlayerState() === YT.PlayerState.PLAYING) {
          startMusicSync();
        }
      } else {
        syncBtn.textContent = 'üéµ ÂêåÊ≠•';
        syncBtn.style.backgroundColor = '#007bff';
        syncBtnNarrow.textContent = 'üé∂';
        syncBtnNarrow.style.backgroundColor = '#007bff';
        syncBtnPlayer.textContent = 'üéµ ÂêåÊ≠•';
        syncBtnPlayer.style.backgroundColor = '#007bff';
        stopMusicSync();

        // Clear all highlights
        document.querySelectorAll('.music-highlight, .music-current').forEach(el => {
          el.classList.remove('music-highlight', 'music-current');
        });
      }
    }

    // Calculate timestamp for a specific line index based on BPM
    function calculateLineTimestamp(lineIndex) {
      const beatsPerLine = 8;
      const millisecondsPerBeat = 60000 / musicSyncSpeed;
      const millisecondsPerLine = millisecondsPerBeat * beatsPerLine;
      return (lineIndex * millisecondsPerLine) / 1000; // Return in seconds
    }

    // Generate YouTube URL with timestamp
    function generateTimestampedUrl(lineIndex) {
      const timestamp = Math.floor(calculateLineTimestamp(lineIndex));
      const currentUrl = youtubeUrl.value.trim() || defaultMusicUrl;

      // Remove existing timestamp parameter if present
      let baseUrl = currentUrl.replace(/[&?]t=\d+/, '');

      // Add timestamp parameter
      const separator = baseUrl.includes('?') ? '&' : '?';
      return `${baseUrl}${separator}t=${timestamp}`;
    }

    // Start automatic play mode from a specific line
    function startAutoPlayFromLine(startLineIndex) {
      // Clear any existing auto play or music sync
      if (autoPlayTimer) {
        clearInterval(autoPlayTimer);
        autoPlayTimer = null;
      }
      stopMusicSync();

      // Clear previous styling
      document.querySelectorAll('.auto-play-current, .auto-play-completed, .music-highlight, .music-current').forEach(el => {
        el.classList.remove('auto-play-current', 'auto-play-completed', 'music-highlight', 'music-current');
      });

      // Enable memory mode if not already active
      if (!memActive) {
        toggleMemMode();
      }

      // Set up auto play from the specified line
      const allItems = document.querySelectorAll('#sheet li');
      let currentIndex = startLineIndex;

      // Mark previous lines as completed
      for (let i = 0; i < startLineIndex && i < allItems.length; i++) {
        allItems[i].classList.add('auto-play-completed', 'memorized');
      }

      // Start the auto play sequence
      function playNextLine() {
        if (currentIndex >= allItems.length) {
          // Reached the end
          autoPlayActive = false;
          autoPlayBtn.setAttribute('aria-pressed', 'false');
          autoPlayBtnNarrow.setAttribute('aria-pressed', 'false');
          if (autoPlayTimer) {
            clearInterval(autoPlayTimer);
            autoPlayTimer = null;
          }
          return;
        }

        // Remove previous current highlighting
        document.querySelectorAll('.auto-play-current').forEach(el => {
          el.classList.remove('auto-play-current');
          el.classList.add('auto-play-completed');
        });

        // Highlight current line
        const currentLine = allItems[currentIndex];
        currentLine.classList.add('auto-play-current', 'memorized');

        // Scroll to current line if needed
        currentLine.scrollIntoView({
          behavior: 'smooth',
          block: 'center',
          inline: 'nearest'
        });

        currentIndex++;
      }

      // Start immediately with the first line
      playNextLine();

      // Set up interval for subsequent lines
      autoPlayActive = true;
      autoPlayBtn.setAttribute('aria-pressed', 'true');
      autoPlayBtnNarrow.setAttribute('aria-pressed', 'true');

      autoPlayTimer = setInterval(playNextLine, getAutoPlayInterval());
    }

    // Open timestamped URL in new window and start play mode
    function openTimestampedUrl(lineIndex) {
      const timestampedUrl = generateTimestampedUrl(lineIndex);
      const timestamp = Math.floor(calculateLineTimestamp(lineIndex));

      // Open in new window
      window.open(timestampedUrl, '_blank');

      // Start automatic play mode from this line
      startAutoPlayFromLine(lineIndex);

      // Show notification
      showCopyNotification(`Â∑≤ÈñãÂïüÊôÇÈñìÈªû ${timestamp}s ÁöÑÈü≥Ê®ÇÊí≠ÊîæÔºå‰∏¶ÂïüÂãïËá™ÂãïÊí≠ÊîæÊ®°Âºè`);
    }

    // Copy timestamped URL to clipboard (kept as alternative)
    function copyTimestampedUrl(lineIndex) {
      const timestampedUrl = generateTimestampedUrl(lineIndex);

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(timestampedUrl).then(() => {
          // Show temporary notification
          showCopyNotification(`Â∑≤Ë§áË£ΩÊôÇÈñìÈªû ${Math.floor(calculateLineTimestamp(lineIndex))}s ÁöÑÈü≥Ê®ÇÈÄ£Áµê`);
        }).catch(err => {
          console.error('Failed to copy to clipboard:', err);
          fallbackCopyToClipboard(timestampedUrl);
        });
      } else {
        fallbackCopyToClipboard(timestampedUrl);
      }
    }

    // Fallback copy method
    function fallbackCopyToClipboard(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.opacity = '0';
      document.body.appendChild(textArea);
      textArea.select();

      try {
        document.execCommand('copy');
        showCopyNotification('Â∑≤Ë§áË£ΩÈü≥Ê®ÇÈÄ£ÁµêÂà∞Ââ™Ë≤ºÁ∞ø');
      } catch (err) {
        console.error('Failed to copy:', err);
        alert('Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïË§áË£ΩÔºö\n' + text);
      }

      document.body.removeChild(textArea);
    }

    // Show copy notification
    function showCopyNotification(message) {
      // Remove existing notification if any
      const existingNotification = document.querySelector('.copy-notification');
      if (existingNotification) {
        existingNotification.remove();
      }

      // Create notification element
      const notification = document.createElement('div');
      notification.className = 'copy-notification';
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        font-size: 14px;
        z-index: 10000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transition: all 0.3s ease;
      `;

      document.body.appendChild(notification);

      // Auto-remove after 3 seconds
      setTimeout(() => {
        if (notification.parentNode) {
          notification.style.opacity = '0';
          notification.style.transform = 'translateY(-20px)';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.remove();
            }
          }, 300);
        }
      }, 3000);
    }

    function loadMusic() {
      const url = youtubeUrl.value.trim();
      if (!url) {
        alert('Ë´ãËº∏ÂÖ• YouTube ÈÄ£Áµê');
        return;
      }

      const videoId = extractVideoId(url);
      if (!videoId) {
        alert('ÁÑ°ÊïàÁöÑ YouTube ÈÄ£ÁµêÊ†ºÂºè');
        return;
      }

      // Hide error message and try to load player
      musicError.style.display = 'none';
      createYouTubePlayer(videoId);

      // Show error message after a delay if there are issues
      setTimeout(() => {
        musicError.style.display = 'block';
      }, 3000);
    }

    function openYouTube() {
      const url = youtubeUrl.value.trim();
      if (!url) {
        alert('Ë´ãËº∏ÂÖ• YouTube ÈÄ£Áµê');
        return;
      }

      window.open(url, '_blank');
    }

    function toggleAutoPlay(){
      if(!autoPlayActive){
        // Clear any existing auto play styling
        document.querySelectorAll('.auto-play-current, .auto-play-completed').forEach(el => {
          el.classList.remove('auto-play-current', 'auto-play-completed');
        });

        if(!memActive){
          toggleMemMode();
        }
        autoPlayActive = true;
        autoPlayBtn.setAttribute('aria-pressed','true');
        autoPlayBtnNarrow.setAttribute('aria-pressed','true');

        // Immediately reveal the next line without delay
        if(memActive && memIndex < allLines.length){
          revealNextLine();
        }

        autoPlayTimer = setInterval(()=>{
          if(memActive && memIndex < allLines.length){
            revealNextLine();
          } else {
            autoPlayActive = false;
            autoPlayBtn.setAttribute('aria-pressed','false');
            autoPlayBtnNarrow.setAttribute('aria-pressed','false');
            if(autoPlayTimer) {
              clearInterval(autoPlayTimer);
              autoPlayTimer = null;
            }
          }
        }, getAutoPlayInterval());
      } else {
        autoPlayActive = false;
        autoPlayBtn.setAttribute('aria-pressed','false');
        autoPlayBtnNarrow.setAttribute('aria-pressed','false');
        if(autoPlayTimer) {
          clearInterval(autoPlayTimer);
          autoPlayTimer = null;
        }

        // Clear auto play styling when stopping
        document.querySelectorAll('.auto-play-current, .auto-play-completed').forEach(el => {
          el.classList.remove('auto-play-current', 'auto-play-completed');
        });
      }
    }

    function copyAll(){
      const visibleElements = Array.from(sheet.querySelectorAll('h1, h2, ol')).filter(el =>
        !el.classList.contains('hidden-line')
      );

      const text = visibleElements.map(node => {
        if (node.tagName === 'OL') {
          const visibleItems = Array.from(node.querySelectorAll('li')).filter(li =>
            !li.classList.contains('hidden-line')
          ).map((li, index) => {
            return `${index + 1}. ${li.textContent}`;
          }).join('\n');
          return visibleItems;
        } else {
          return node.innerText;
        }
      }).join('\n\n');

      if(navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(text).then(()=>{
          const prev = copyBtn.innerText;
          copyBtn.innerText = 'Â∑≤Ë§áË£Ω';
          setTimeout(()=>copyBtn.innerText = prev,900);
        }).catch(()=>{
          alert('Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïÈÅ∏ÂèñÂæåË§áË£Ω');
        });
      } else {
        alert('Ê≠§ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥Ââ™Ë≤ºÁ∞ø APIÔºåË´ãÊâãÂãïË§áË£Ω');
      }
    }

    document.addEventListener('keydown', (e) => {
      const activeTag = document.activeElement && (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'SELECT' || document.activeElement.isContentEditable);
      if(activeTag) return;

      if(e.code === 'Space'){
        e.preventDefault();
        if(!memActive){ toggleMemMode(); } else { revealNextLine(); }
        return;
      }

      switch(e.key){
        case 'm': case 'M': e.preventDefault(); toggleMemMode(); break;
        case 'a': case 'A': e.preventDefault(); toggleAutoPlay(); break;
        case 'r': case 'R': e.preventDefault(); resetMem(); break;
        case 'c': case 'C': e.preventDefault(); copyAll(); break;
        case '+': case '=': e.preventDefault(); changeFont(1); break;
        case '-': e.preventDefault(); changeFont(-1); break;
        case '1': case '2': case '3': case '4': case '5': case '6': e.preventDefault(); setColumns(Number(e.key)); break;
      }
    });

    memBtn.addEventListener('click', (e)=>{ toggleMemMode(); });
    autoPlayBtn.addEventListener('click', (e)=>{ toggleAutoPlay(); });
    resetMemBtn.addEventListener('click', resetMem);
    copyBtn.addEventListener('click', copyAll);
    fontDecBtn.addEventListener('click', ()=>{ changeFont(-1); });
    fontIncBtn.addEventListener('click', ()=>{ changeFont(1); });
    toggleToolbarBtn.addEventListener('click', toggleToolbar);
    helpBtn.addEventListener('click', showHelp);
    musicBtn.addEventListener('click', toggleMusicPlayer);
    closeMusicBtn.addEventListener('click', toggleMusicPlayer);
    loadMusicBtn.addEventListener('click', loadMusic);
    openYouTubeBtn.addEventListener('click', openYouTube);

    // Allow Enter key to load music
    youtubeUrl.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        loadMusic();
      }
    });

    autoPlaySlowBtn.addEventListener('click', () => changeAutoPlaySpeed(-10));
    autoPlayFastBtn.addEventListener('click', () => changeAutoPlaySpeed(10));
    autoPlaySlowBtnNarrow.addEventListener('click', () => changeAutoPlaySpeed(-10));
    autoPlayFastBtnNarrow.addEventListener('click', () => changeAutoPlaySpeed(10));

    memBtnNarrow.addEventListener('click', ()=>{
      toggleMemMode();
      memBtnNarrow.setAttribute('aria-pressed', memBtn.getAttribute('aria-pressed'));
    });
    autoPlayBtnNarrow.addEventListener('click', ()=>{
      toggleAutoPlay();
      autoPlayBtnNarrow.setAttribute('aria-pressed', autoPlayBtn.getAttribute('aria-pressed'));
    });
    resetMemBtnNarrow.addEventListener('click', resetMem);
    copyBtnNarrow.addEventListener('click', copyAll);
    fontDecBtnNarrow.addEventListener('click', ()=>{ changeFont(-1); });
    fontIncBtnNarrow.addEventListener('click', ()=>{ changeFont(1); });
    helpBtnNarrow.addEventListener('click', showHelp);
    musicBtnNarrow.addEventListener('click', toggleMusicPlayer);

    // Music sync event listeners
    musicSyncBtn.addEventListener('click', toggleMusicSync);
    musicSyncBtnNarrow.addEventListener('click', toggleMusicSync);
    musicSyncBtnPlayer.addEventListener('click', toggleMusicSync);

    // Sync speed selector
    syncSpeedSelect.addEventListener('change', (e) => {
      musicSyncSpeed = parseInt(e.target.value);
    });

    // Music selection dropdown
    musicSelect.addEventListener('change', (e) => {
      if (e.target.value === 'custom') {
        youtubeUrl.style.display = 'block';
        youtubeUrl.focus();
      } else if (e.target.value) {
        youtubeUrl.style.display = 'none';
        youtubeUrl.value = e.target.value;
        loadMusic();
      } else {
        youtubeUrl.style.display = 'none';
        youtubeUrl.value = '';
      }
    });

    window.addEventListener('load', ()=>{
      fontPreset.value = DEFAULT_FONT_SIZE;
      sheet.style.fontSize = DEFAULT_FONT_SIZE + 'px';

      loadContentFromMarkdown();

      // Initialize after content is fully loaded
      initializeAfterContentLoad();

      // Auto-load default music
      youtubeUrl.value = defaultMusicUrl;
      setTimeout(() => {
        loadMusic();
      }, 1000);
    });

    window.addEventListener('resize', ()=>{
      responsiveColumnAdjust();
      setTimeout(checkToolbarWrap, 100);
    });
  </script>
</body>
</html>
